<!DOCTYPE html>
<html>
  <head>
    <title>libvpx cli generator</title>
    <style type="text/css">
      html, body, table, tr, td {
        margin: 0;
        padding: 0;
        border: 0;
      }

      input {
        vertical-align:middle;
      }

      input[type='radio'],
      input[type='checkbox'],
      label {
        cursor: pointer;
      }

      .column {
        float: left;
        margin-left:40px;
      }

      .section {
        margin-bottom: 5px;
        margin-left: 10px;
      }

      .section > .title {
        font-family: arial;
        font-weight: bold;
      }

      .section > .body {
        margin-left: 10px;
      }


      .subsection {
        margin-bottom: 5px;
      }

      .subsection > .title {

      }

      .subsection > .body {
        margin-left: 10px;
      }

      .selected {
        padding-bottom: 1px;
        border-bottom: 1px dashed;
      }

      .indent {
        margin-left: 10px;
      }

      .value {
        font-size: 8pt;
      }

      #cmd {
        background-color:black;
        padding-top:10px;
        padding-bottom:10px;
        padding-left:5px;
        margin-bottom: 10px;
        height: 3em;
      }

      #cmd-copy {
        margin-right: 20px;
      }

      #cmd-line {
        font-size:12pt;
        font-family:monospace;
        color:white;
      }

      #panel p {
        display: inline;
      }

      [rv-on-click]:not([rv-on-click=""]) {
        cursor: pointer;
      }

      #width, #height {
        width: 40px;
      }

      #fps-num, #fps-den {
        width: 30px;
      }

      .preset {
        text-decoration: none;
        border-bottom:1px dashed;
        cursor: pointer;
      }

    </style>
  </head>
  <body>
    <div id="panel">
      <div id="cmd" style="visibility:hidden">
        <button style="float:left" id="cmd-copy">Copy</button>
        <div style="float:clear" id="cmd-line">
          <p>vpxenc --codec={m.codec}</p>
          <p rv-class-selected="ui.in.lag_in_frames"
             rv-show="m.lag_in_frames.enabled">--lag-in-frames={m.lag_in_frames.value}</p>
          <p rv-class-selected="ui.in.debug"
             rv-inside="ui.in.debug"
             rv-show="m.debug">--debug</p>
          <p rv-class-selected="ui.in.verbose"
             rv-inside="ui.in.verbose"
             rv-show="m.verbose">--verbose</p>
          <p rv-class-selected="ui.in.psnr"
             rv-inside="ui.in.psnr"
             rv-show="m.psnr">--psnr</p>
          <p rv-class-selected="ui.in.quiet"
             rv-inside="ui.in.quiet"
             rv-show="m.quiet">--quiet</p>
          <p rv-class-selected="ui.frame_parallel"
             rv-inside="m.frame_parallel"
             rv-show="m.frame_parallel">--frame-parallel</p>
          <p rv-class-selected="ui.in.passes"
             rv-inside="ui.in.passes"
             rv-on-click="ui.cycle.passes">--passes={m.passes}</p>
          <p rv-class-selected="ui.in.usage"
             rv-inside="ui.in.usage"
             rv-on-click="ui.cycle.usage">--end-usage={m.usage}</p>
          <p rv-class-selected="ui.in.bitrate"
             rv-inside="ui.in.bitrate"
             rv-show="m.usage | in vbr cbr cq"
             data-control-id="bitrate">--target-bitrate={m.bitrate}</p>
          <p rv-class-selected="ui.in.undershoot_pct"
             rv-inside="ui.in.undershoot_pct"
             rv-show="m.undershoot_pct.enabled"
             data-control-id="undershoot-pct">--undershoot-pct={m.undershoot_pct.value}</p>
          <p rv-class-selected="ui.in.overshoot_pct"
             rv-inside="ui.in.overshoot_pct"
             rv-show="m.overshoot_pct.enabled"
             data-control-id="overshoot-pct">--overshoot-pct={m.overshoot_pct.value}</p>
          <p rv-class-selected="ui.in.cq_level"
             rv-inside="ui.in.cq_level"
             rv-show="m.usage | in cq q"
             data-control-id="cq-level">--cq-level={m.cq_level}</p>
          <p rv-class-selected="ui.in.quality"
             rv-inside="ui.in.quality"
             rv-on-click="ui.cycle.quality">--{m.quality}</p>
          <p rv-class-selected="ui.in.speed"
             rv-inside="ui.in.speed"
             rv-show="m.quality | in rt good"
             rv-on-click="ui.cycle.speed"
             data-control-id="speed">--cpu-used={m.speed}</p>
          <p rv-class-selected="ui.in.kf_min_dist"
             rv-inside="ui.in.kf_min_dist"
             rv-show="m.kf_min_dist.enabled">--kf-min-dist={m.kf_min_dist.value}</p>
          <p rv-class-selected="ui.in.kf_max_dist"
             rv-inside="ui.in.kf_max_dist"
             rv-show="m.kf_max_dist.enabled">--kf-max-dist={m.kf_max_dist.value}</p>
          <p rv-class-selected="ui.in.min_q"
             rv-inside="ui.in.min_q"
             rv-show="m.min_q.enabled"
             data-control-id="min-q">--min-q={m.min_q.value}</p>
          <p rv-class-selected="ui.in.max_q"
             rv-inside="ui.in.max_q"
             rv-show="m.max_q.enabled"
             data-control-id="max-q">--max-q={m.max_q.value}</p>
          <p rv-class-selected="ui.in.arf.enabled"
             rv-inside="ui.in.arf.enabled">--auto-alt-ref={m.arf.enabled | bool}</p>
          <p rv-class-selected="ui.in.arf.nr.frames"
             rv-inside="ui.in.arf.nr.frames"
             rv-show="m.arf.enabled"
             data-control-id="arf-nr-frames">--arnr-maxframes={m.arf.nr.frames}</p>
          <p rv-class-selected="ui.in.arf.nr.strength"
             rv-inside="ui.in.arf.nr.strength"
             rv-show="m.arf.enabled"
             data-control-id="arf-nr-strength">--arnr-strength={m.arf.nr.strength}</p>
          <p rv-class-selected="ui.in.tiles"
             rv-inside="ui.in.tiles"
             rv-show="m.tiles.enabled">--tile-rows={m.tiles.rows} --tile-cols={m.tiles.cols}</p>
          <p rv-class-selected="ui.in.aq"
             rv-inside="ui.in.aq"
             rv-show="m.aq | in 1 2 3">--aq-mode={m.aq}</p>
          <p rv-class-selected="ui.in.input.skip"
             rv-inside="ui.in.input.skip"
             rv-show="m.input.skip.enabled">--skip={m.input.skip.value}</p>
          <p rv-class-selected="ui.in.input.limit"
             rv-inside="ui.in.input.limit"
             rv-show="m.input.limit.enabled">--limit={m.input.limit.value}</p>
          <p rv-class-selected="ui.in.fps"
             rv-inside="ui.in.fps"
             rv-show="m.fps.enabled">--fps={m.fps.num}/{m.fps.den}</p>
          <p rv-class-selected="ui.in.input.format"
             rv-inside="ui.in.input.format"
             rv-show="m.input.format | in i420 i422 i444 yv12">--{m.input.format}</p>
          <p rv-class-selected="ui.in.input.size"
             rv-inside="ui.in.input.size"
             rv-show="m.input.format | in i420 i422 i444 yv12">--width={m.input.width} --height={m.input.height}</p>
          <p rv-class-selected="ui.in.input.src"
             rv-inside="ui.in.input.src"
             rv-show="m.input.type | eq file">{m.input.name}.{m.input.format | extension}</p>
          <p rv-class-selected="ui.in.input.src"
             rv-inside="ui.in.input.src"
             rv-show="m.input.type | eq stdin">-</p>
          <p rv-class-selected="ui.in.output_format"
             rv-inside="ui.in.output_format"
             rv-show="m.output.format | eq ivf">--ivf</p>
          <p rv-class-selected="ui.in.output_dst"
             rv-inside="ui.in.output_dst"
             rv-show="m.output.type | eq file">-o {m.output.name}.{m.output.format}</p>
          <p rv-class-selected="ui.in.output_dst"
             rv-inside="ui.in.output_dst"
             rv-show="m.output.type | eq stdout">-o -</p>
        </div>
      </div>

      <div class="column">
        <div class="section">
          <div class="title">Passes</div>
          <div class="body" rv-inside="ui.in.passes">
            <label><input type="radio" name="passes" value="1" rv-checked="m.passes"/>One</label>
            <label><input type="radio" name="passes" value="2" rv-checked="m.passes"/>Two</label>
          </div>
        </div>

        <div class="section">
          <div class="title">Usage</div>
          <div class="body" rv-inside="ui.in.usage">
            <label><input type="radio" name="usage" value="vbr"
                          rv-checked="m.usage"/>VBR (Variable Bitrate)</label><br/>
            <label><input type="radio" name="usage" value="cbr"
                          rv-checked="m.usage"/>CBR (Constant Bitrate)</label><br/>
            <label><input type="radio" name="usage" value="cq"
                          rv-checked="m.usage"/>CQ (Constained Quality)</label><br/>
            <label><input type="radio" name="usage" value="q"
                          rv-checked="m.usage"/>Q (Constant Quality)</label>
          </div>
        </div>

        <div class="section">
          <div class="title">Speed</div>
          <div class="body">
            <div rv-inside="ui.in.quality">
              <label><input type="radio" name="quality" value="rt" rv-checked="m.quality"/>Real Time</label>
              <label><input type="radio" name="quality" value="good" rv-checked="m.quality"/>Good</label>
              <label><input type="radio" name="quality" value="best" rv-checked="m.quality"/>Best</label>
            </div>
            <div rv-inside="ui.in.speed">
              <input id="speed" type="range" min="0" max="10" 
                     rv-input="m.speed" rv-enabled="m.quality | in rt good"/>
              <span class="value" rv-text="m.speed"></span>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="title">Rate Control</div>
          <table class="body" role="presentation">
            <tr rv-inside="ui.in.bitrate">
              <td></td>
              <td>Bitrate</td>
              <td><input id="bitrate" type="text"
                         rv-input="m.bitrate"
                         rv-enabled="m.usage | in vbr cbr cq"/>&nbsp;kbps</td>
            </tr>
            <tr rv-inside="ui.in.undershoot_pct">
              <td><input id="enable-undershoot-pct" type="checkbox"
                         rv-checked="m.undershoot_pct.enabled"/></td>
              <td><label for="enable-undershoot-pct">Undershoot</label></td>
              <td><input id="undershoot-pct" type="text"
                         rv-input="m.undershoot_pct.value"
                         rv-enabled="m.undershoot_pct.enabled"/>&nbsp;%</td>
            </tr>
            <tr rv-inside="ui.in.overshoot_pct">
              <td><input id="enable-overshoot-pct" type="checkbox"
                         rv-checked="m.overshoot_pct.enabled"/></td>
              <td><label for="enable-overshoot-pct">Overshoot</label></td>
              <td><input id="overshoot-pct" type="text"
                         rv-input="m.overshoot_pct.value"
                         rv-enabled="m.overshoot_pct.value"/>&nbsp;%</td>
            </tr>
          </table>
        </div>

        <div class="section">
          <div class="title">Quantization</div>
          <div class="body">
            <table role="presentation">
              <tr rv-inside="ui.in.cq_level">
                <td></td>
                <td>Main Quantizer</td>
                <td><input id="cq-level" type="range"
                           min="0" max="63"
                           rv-input="m.cq_level"
                           rv-enabled="m.usage | in cq q"/></td>
                <td class="value" rv-text="m.cq_level"/>
              </tr>
              <tr rv-inside="ui.in.min_q">
                <td><input id="enable-min-q" type="checkbox" rv-checked="m.min_q.enabled"/></td>
                <td><label for="enable-min-q">Min Quantizer</label></td>
                <td><input id="min-q" type="range"
                           min="0" max="63"
                           rv-enabled="m.min_q.enabled"
                           rv-input="m.min_q.value"/></td>
                <td class="value" rv-text="m.min_q.value"/>
              </tr>
              <tr rv-inside="ui.in.max_q">
                <td><input id="enable-max-q" type="checkbox" rv-checked="m.max_q.enabled"/></td>
                <td><label for="enable-max-q">Max Quantizer</label></td>
                <td><input id="max-q" type="range"
                           min="0" max="63"
                           rv-enabled="m.max_q.enabled"
                           rv-input="m.max_q.value"/></td>
                <td class="value" rv-text="m.max_q.value"/>
              </tr>
            </table>

            <div class="subsection">
              <div class="title">Adaptive</div>
              <div class="body" rv-inside="ui.in.aq">
                <label><input type="radio" name="aq" value="0" rv-checked="m.aq"/>Off</label><br/>
                <label><input type="radio" name="aq" value="1" rv-checked="m.aq"/>Variance</label><br/>
                <label><input type="radio" name="aq" value="2" rv-checked="m.aq"/>Complexity</label><br/>
                <label><input type="radio" name="aq" value="3" rv-checked="m.aq"/>Cyclic refresh</label>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="title">Tiles</div>
          <div class="body" rv-inside="ui.in.tiles">
            <label><input type="checkbox" rv-checked="m.tiles.enabled"/>Enable</label>
              <select rv-value="m.tiles.rows" rv-enabled="m.tiles.enabled">
                <option value="0">1</option>
                <option value="1">2</option>
                <option value="2">4</option>
              </select> &times;
              <select rv-value="m.tiles.cols" rv-enabled="m.tiles.enabled">
                <option value="0">1</option>
                <option value="1">2</option>
                <option value="2">4</option>
                <option value="3">8</option>
                <option value="4">16</option>
                <option value="5">32</option>
                <option value="6">64</option>
              </select>
          </div> 
        </div>

      </div>

      <div class="column">
        <div class="section">
          <div class="title">Key Frames</div>
          <table role="presenetation" class="body">
            <tr rv-inside="ui.in.kf_min_dist">
              <td><input id="enable-min-distance" type="checkbox" rv-checked="m.kf_min_dist.enabled"/></td>
              <td><label for="enable-min-distance">Min Distance</label></td>
              <td><input type="text" 
                         rv-enabled="m.kf_min_dist.enabled"
                         rv-input="m.kf_min_dist.value"/>&nbsp;frames</td>
            </tr>
            <tr rv-inside="ui.in.kf_max_dist">
              <td><input id="enable-max-distance" type="checkbox" rv-checked="m.kf_max_dist.enabled"/></td>
              <td><label for="enable-max-distance">Max Distance</label></td>
              <td><input type="text"
                         rv-enabled="m.kf_max_dist.enabled"
                         rv-input="m.kf_max_dist.value"/>&nbsp;frames</td>
            </tr>
          </table>
        </div>

        <div class="section">
          <div class="title">Alt Reference Frames</div>
          <div class="body">
            <div rv-inside="ui.in.arf.enabled">
              <label><input type="checkbox" rv-checked="m.arf.enabled"/>Enable</label>
            </div>
            <div class="subsection">
              <div class="title">Temporal Noise Reduction</div>
              <table class="body">
                <tr rv-inside="ui.in.arf.nr.frames">
                  <td>Frames</td>
                  <td><input id="arf-nr-frames" type="range"
                             min="0" max="15"
                             rv-enabled="m.arf.enabled"
                             rv-input="m.arf.nr.frames"/></td>
                  <td class="value" rv-text="m.arf.nr.frames"/>
                </tr>
                <tr rv-inside="ui.in.arf.nr.strength">
                  <td>Strength</td>
                  <td><input id="arf-nr-strength" type="range"
                             min="0" max="6"
                             rv-enabled="m.arf.enabled"
                             rv-input="m.arf.nr.strength"/></td>
                  <td class="value" rv-text="m.arf.nr.strength"/>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="title">Miscellaneous</div>
          <div class="body">
            <label rv-inside="ui.in.debug">
              <input type="checkbox" rv-checked="m.debug"/>Debug mode
            </label><br/>
            <label rv-inside="ui.in.verbose">
              <input type="checkbox" rv-checked="m.verbose"/>Show encoder paramters
            </label><br/>
            <label rv-inside="ui.in.psnr">
              <input type="checkbox" rv-checked="m.psnr"/>Show PSNR in status line
            </label><br/>
            <label rv-inside="ui.in.quiet">
              <input type="checkbox" rv-checked="m.quiet"/>Do not print encode progress
            </label><br/>
            <label rv-inside="ui.parallel.frame">
              <input type="checkbox" rv-checked="m.frame_parallel"/>Enable frame parallel decodability
            </label>
            <div rv-inside="ui.in.lag_in_frames">
              <label><input type="checkbox" rv-checked="m.lag_in_frames.enabled"/>Lag-in</label>
              <input type="text" rv-enabled="m.lag_in_frames.enabled" rv-input="m.lag_in_frames.value"/> frames
            </div>
          </div>
        </div>
      </div>

      <div class="column">
        <div class="section">
          <div class="title">Input</div>
          <div class="body">
            <table role="presentation">
              <tr rv-inside="ui.in.input.skip">
                <td><input id="enable-skip" type="checkbox" rv-checked="m.input.skip.enabled"/></td>
                <td><label for="enable-skip">Skip</label></td>
                <td><input type="text"
                           rv-input="m.input.skip.value"
                           rv-enabled="m.input.skip.enabled"/>&nbsp;frames</td>
              </tr>

              <tr rv-inside="ui.in.input.limit">
                <td><input id="enable-limit" type="checkbox" rv-checked="m.input.limit.enabled"/></td>
                <td><label for="enable-limit">Limit</label></td>
                <td><input type="text"
                           rv-input="m.input.limit.value"
                           rv-enabled="m.input.limit.enabled"/>&nbsp;frames</td>
              </tr>
              <tr rv-inside="ui.in.fps">
                <td><input id="enable-fps" type="checkbox" rv-checked="m.fps.enabled"/></td>
                <td><label for="enable-fps">FPS</label></td>
                <td><input id="fps-num" type="text" rv-enabled="m.fps.enabled" rv-input="m.fps.num"/> /
                    <input id="fps-den" type="text" rv-enabled="m.fps.enabled" rv-input="m.fps.den"/></td>
              </tr>
            </table>

            <div class="subsection">
              <div class="title">Format</div>
              <div class="body">
                <label><input type="radio"
                              name="input-format"
                              value="y4m"
                              rv-checked="m.input.format"/>Y4M</label><br/>
                <div>
                  <div style="float:left;width:45%;overflow:hidden;padding:0;margin:0px;border-right:solid black 1px"
                       rv-inside="ui.in.input.format">
                    <label><input type="radio"
                                  name="input-format"
                                  value="i420"
                                  rv-checked="m.input.format"/>YUV 4:2:0</label><br/>
                    <label><input type="radio"
                                  name="input-format"
                                  value="i422"
                                  rv-checked="m.input.format"/>YUV 4:2:2</label><br/>
                    <label><input type="radio"
                                  name="input-format"
                                  value="i444"
                                  rv-checked="m.input.format"/>YUV 4:4:4</label><br/>
                    <label><input type="radio"
                                  name="input-format"
                                  value="yv12"
                                  rv-checked="m.input.format"/>YV12</label>
                  </div>

                  <div style="float:left;width:50%;overflow:hidden;margin-left:5px;margin-left:5px;margin-top:25px"
                       rv-inside="ui.in.input.size">
                    <input id="width" type="text"
                           rv-input="m.input.width"
                           rv-enabled="m.input.format | in i420 i422 i444 yv12"/> &times;
                    <input id="height" type="text"
                           rv-input="m.input.height"
                           rv-enabled="m.input.format | in i420 i422 i444 yv12"/>
                  </div>

                  <div style="clear:both"></div>
                </div>
              </div>
            </div>

            <div class="subsection">
              <div class="title">Source</div>
              <div class="body" rv-inside="ui.in.input.src">
                <label><input type="radio" name="input-type" value="file"
                              rv-checked="m.input.type"/>File</label>
                  <input type="text"
                         rv-enabled="m.input.type | eq file"
                         rv-input="m.input.name"/>.<span rv-text="m.input.format | extension"></span><br/>
                <label><input type="radio" name="input-type" value="stdin"
                              rv-checked="m.input.type"/>STDIN</label><br/>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="title">Output</div>
          <div class="body">
            <div class="subsection">
              <div class="title">Format</div>
              <div class="body" rv-inside="ui.in.output_format">
                <label><input type="radio"
                              name="output_format"
                              value="webm"
                              rv-checked="m.output.format"/>WebM</label><br/>
                <label><input type="radio"
                              name="output_format"
                              value="ivf"
                              rv-checked="m.output.format"/>IVF</label>
              </div>
            </div>
            <div class="subsection">
              <div class="title">Destination</div>
              <div class="body" rv-inside="ui.in.output_dst">
                <label><input type="radio" name="output-type" value="file"
                              rv-checked="m.output.type"/>File</label>
                  <input type="text"
                         rv-enabled="m.output.type | eq file"
                         rv-input="m.output.name"/>.<span rv-text="m.output.format"></span><br/>
                <label><input type="radio" name="output-type" value="stdout"
                              rv-checked="m.output.type"/>STDOUT</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="section">
          <div class="title">Builtin Presets</div>
          <div class="body">
            <a class="preset" id="preset-default">Default</a>
          </div>
        </div>

        <div class="section">
          <div class="title">User Presets</div>
          <div class="body" id="presets">
            <div rv-each-preset="presets">
              <a class="preset" rv-text="preset.name"></a>
              <button class="preset-remove">X</button>
            </div>
            <button id="preset-add">Add Preset</button>
          </div>
        </div>
      </div>
      
    </div>
    
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="js/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="js/rivets.min.js"></script>
    
    <script>
      function getParamCycle(param, values) {
        return function(event, models) {
          var model = models.m;
          model[param] = values[($.inArray(model[param], values) + 1) % values.length];
        };
      }

      var ui = {
        in: {
          passes: false,
          usage: false,
          bitrate: false,
          undershoot_pct: false,
          overshoot_pct: false,
          cq_level: false,
          quality: false,
          speed: false,
          aq: false,
          tiles: false,
          debug: false,
          verbose: false,
          quiet: false,
          psnr: false,
          frame_parallel: false,
          min_q: false,
          max_q: false,
          kf_min_dist: false,
          kf_max_dist: false,
          arf: {enabled: false,
                nr: {frames: false, strength: false}},
          lag_in_frames: false,
          input: {skip: false,
                  limit: false,
                  format: false,
                  size: false,
                  src: false},
          output: {format: false,
                   dst: false},
          fps: false
        },
        cycle: {
          passes:  getParamCycle('passes', [1, 2]),
          usage:   getParamCycle('usage', ['vbr', 'cbr', 'cq', 'q']),
          quality: getParamCycle('quality', ['rt', 'good', 'best']),
          speed:   getParamCycle('speed', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]),
        }
      };

      var m = {codec:'vp9', 
               debug: false,
               verbose: false,
               psnr: false,
               quiet: false,
               frame_parallel: false,
               input: {format: 'y4m', // 'y4m', 'i420', 'i422', 'i444'
                       width: 640,
                       height: 480,
                       type: 'file', // 'file', 'stdin'
                       name: 'input',
                       limit: {value: 100, enabled: false},
                       skip: {value: 0, enabled: false}},
               output: {format: 'webm', // 'ivf', 'webm'
                        type: 'file', //  'file', 'stdout'
                        name: 'output'},
               passes: 2,            // 1, 2
               usage: 'vbr',     // 'vbr', 'cbr', 'cq', 'q'
               quality: 'good',      // 'rt', 'good', 'best'
               speed: 1,             // 0, 1, 2, 3, ..., 10
               bitrate: 600,  // > 0
               undershoot_pct: {value: 10, enabled: false},
               overshoot_pct: {value: 10, enabled: false},
               cq_level: 10,         // 0, 1, 2, ..., 63
               aq: 0,                // 0, 1, 2, 3
               tiles: {rows: 0, cols:0, enabled: false},
               arf: {enabled: true,
                     nr: {frames: 0, strength: 0}},
               kf_min_dist: {value: 0, enabled: false},
               kf_max_dist: {value: 9999, enabled: false},
               min_q: {value: 0, enabled: false},
               max_q: {value: 63, enabled: false},
               lag_in_frames: {value: 25, enabled: false},
               fps: {num:30, den:1, enabled:false},
             };

      function savePresets(presets) {
        var storage = window.localStorage;
        storage.setItem('presets', JSON.stringify(presets));
      }

      function loadPresets() {
        var storage = window.localStorage;
        var presets = JSON.parse(storage.getItem('presets'));
        return presets ? presets : [];
      }

      function deepCopy(m) {
        return $.extend(true, {}, m);
      }

      function generatePresetName(m) {
        name = '';
        name += m.passes == 1 ? 'one-pass' : 'two-pass';
        name += '-' + m.usage;
        name += '-' + m.quality;
        if (m.quality != 'best') {
          name += m.speed;
        }
        if (m.usage != 'q') {
          name += '-' + m.bitrate + 'kbps';
        }
        if (m.usage == 'cq' || m.usage == 'q') {
          name += '-q' + m.cq_level;
        }
        return name;
      }

      var presets = loadPresets();
      var defaultPreset = deepCopy(m);

      $('#preset-default').on('click', function() {
        $.extend(true, m, defaultPreset);
      });

      $('#presets').on('click', '.preset', function() {
        var index = $(this).parent().index();
        var preset = presets[index];
        $.extend(true, m, preset.value);
      });

      $('#presets').on('click', '.preset-remove', function() {
        var index = $(this).parent().index();
        presets.splice(index, 1);
        savePresets(presets);
      });

      $('#preset-add').on('click', function() {
        var name = prompt("Preset Name", generatePresetName(m));
        if (name) {
          presets.push({name:name, value:deepCopy(m)});
          savePresets(presets);
        }
      });

      rivets.binders.inside = {
        publishes: true,
        bind: function(el) {
          var self = this;

          this.enter_callback = function() {
            self.observer.publish(1);
          }

          this.leave_callback = function() {
            self.observer.publish(0);
          }

          $(el).on('mouseenter', this.enter_callback);
          $(el).on('mouseleave', this.leave_callback);
        },

        unbind: function(el) {
          $(el).off('mouseenter', this.enter_callback)
          $(el).off('mouseleave', this.leave_callback);
        },
      };

      rivets.binders.input = {
        publishes: true,
        routine: rivets.binders.value.routine,
        bind: function (el) {
          $(el).on('input change', this.publish);
        },
        unbind: function (el) {
          $(el).off('input change', this.publish);
        }
      };

      rivets.formatters.extension = function (value) {
        if (value == 'i420' || value == 'i422' || value ==  'i444' || value == 'yv12') {
          return 'yuv'
        } else {
          return 'y4m'
        }
      }

      rivets.formatters.bool = function(value){
        return value ? 1 : 0;
      }

      rivets.formatters.eq = function (value, args) {
        return value === args;
      };

      rivets.formatters.in = function (value, args) {
        return $.inArray(value, arguments, 1) !== -1;
      };

      var view = rivets.bind($('#panel'), {
        m: m,
        ui: ui,
        presets: presets,
      });

      $('#cmd').css('visibility', 'visible');

      var textControl = null;

      $('#panel [data-control-id]:not([data-control-id=""])')
        .on('mouseenter', function(event) {
          var id = $(event.target).attr('data-control-id');
          textControl = $('#' + id);
        })
        .on('mouseleave', function (event) {
          textControl = null;
        });

      var rangeControl = null;

      $('#panel input[type=range]')
        .on('mouseenter', function(event){
          rangeControl = $(event.target);
        })
        .on('mouseleave', function(event ){
          rangeControl = null;
        });

      $(document).on('keydown', function(event) {
        if (rangeControl) {
          var val = parseInt(rangeControl.val());
          if (event.keyCode === 38) {
            rangeControl.val(val + 1).trigger('change');
            event.preventDefault();
          } else if (event.keyCode === 40) {
            rangeControl.val(val - 1).trigger('change');
            event.preventDefault();
          }
        }
        
        if (textControl) {  
          var delta = (event.ctrlKey && event.shiftKey) ? 100 : (event.shiftKey ? 10 : 1);
          var val = parseInt(textControl.val());
          if (event.keyCode === 38) {
            textControl.val(val + delta).trigger('change');
            event.preventDefault();
          } else if (event.keyCode === 40) {
            textControl.val(val - delta).trigger('change');
            event.preventDefault();
          } 
        }
      });

      $(document).on('mousewheel', function(event) {
        if (rangeControl) {
          var delta = event.originalEvent.wheelDelta > 0 ? 1 : -1;
          var val = parseInt(rangeControl.val());
          rangeControl.val(val + delta).trigger('change');
          event.preventDefault();
        }

        if (textControl) {  
          var delta = event.originalEvent.wheelDelta > 0 ? 1 : -1;
          var val = parseInt(textControl.val());
          textControl.val(val + delta).trigger('change');
          event.preventDefault();
        }
      });

      var client = new ZeroClipboard($('#cmd-copy'));
      client.on('copy', function(event) {
        var cmd = $('#cmd-line').children(":visible")
                                .map(function(){ return $(this).text() })
                                .get().join(' ')
                                .replace(/(\r\n|\n|\r)/gm," ")
                                .replace(/\s+/g," ")
                                .trim();
        console.log(cmd);
        var clipboard = event.clipboardData;
        clipboard.setData("text/plain", cmd);
      });
    </script>
  </body>
</html>
